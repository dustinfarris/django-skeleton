language: python
python:
  - "2.7"
env:
  - DJANGO=1.4.3
branch:
  only:
    - master
    - production
install:
  - sudo apt-get install -qq libxapian22 python-xapian
  - ln -sf /usr/lib/python2.7/dist-packages/xapian $VIRTUAL_ENV/lib/python2.7/site-packages/.
  - pip install -q Django==$DJANGO --use-mirrors
  - make develop
before_script:
  - createuser -s -U postgres web
  - createdb -U postgres {{ project_name }}
  - touch {{ project_name }}/settings/__init__.py
script:
  - make test
